name: Simple Web Server

on:
  workflow_dispatch:
    inputs:
      port:
        description: 'Server port'
        required: true
        default: 8080
        type: number

jobs:
  web-server:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Create simple server
      run: |
        cat > server.py << 'EOF'
from http.server import HTTPServer, BaseHTTPRequestHandler
import json

class SimpleHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        if self.path == '/':
            self.send_response(200)
            self.send_header('Content-type', 'text/html')
            self.end_headers()
            html = """
            <html>
            <body>
                <h1>Simple Web Server</h1>
                <p>This server is running on GitHub Actions!</p>
                <p>Path: {}</p>
            </body>
            </html>
            """.format(self.path)
            self.wfile.write(html.encode())
        else:
            self.send_error(404)

    def log_message(self, format, *args):
        print(f"Server: {format % args}")

if __name__ == '__main__':
    port = 8080
    server = HTTPServer(('0.0.0.0', port), SimpleHandler)
    print(f"Server running on port {port}")
    server.serve_forever()
EOF

    - name: Start server
      run: |
        python server.py &
        echo "Server started on port 8080"
        sleep 300
